<!DOCTYPE html>
<html lang="en">

  <head>

        <title>Time scrubber 5</title>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=Edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

        <!-- Stylesheets -->
        <link rel="stylesheet" href="https://rsms.me/inter/inter.css">

        <!-- Flickity Stylesheets -->
        <link rel="stylesheet" href="resources/js/flickity/flickity.min.css" media="screen">

        <!-- Leaflet Stylesheets -->
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
        <link rel="stylesheet" href="resources/js/leaflet/leaflet.timedimension.control.min.css" />

        <!-- Flickity Javascript -->
        <script src="resources/js/flickity/flickity.pkgd.min.js"></script>

        <!-- Leaflet Javascript -->
        <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
        <script type="text/javascript" src="resources/js/leaflet/leaflet.non.tiled.layer.js"></script>
        <script type="text/javascript" src="resources/js/leaflet/iso8601.min.js"></script>
        <script type="text/javascript" src="resources/js/leaflet/leaflet.timedimension.min.js"></script>

        <style>

            html,
            body,
            #map {
                margin: 0;
                padding: 0;
                width: 100%;
                max-width: 3072px;  /* WMS Limit */
                height: 100%;
                max-height: 3072px;  /* WMS Limit */
                background-color: #fff;
                font-family: Inter, Arial, Helvetica, sans-serif;
            }

            /* Reset Control margin to 0 (zero) */

            .leaflet-top .leaflet-control {
                margin-top: 0;
            }

            .leaflet-right .leaflet-control {
                margin-right: 0;
            }

            .leaflet-bottom .leaflet-control {
                margin-bottom: 0;
            }

            .leaflet-left .leaflet-control {
                margin-left: 0;
            }

            .time-scrubber-container {
                background: #f0f0f0;
                width: 100vw;
                height: 100px;
            }

            .selected-time-step-indicator {
                display: flex;
                justify-content: center;
                padding-top: 10px;
            }

            .selected-time-step-marker {
                display: flex;
                justify-content: center;
            }

            .time-step-carousel {
                height: 40px;
            }

            .time-step-carousel-cell {
                height: 100%;
            }

        </style>

    </head>

    <body>

        <div id="map"></div>

        <script>

            document.addEventListener('DOMContentLoaded', function(event) {

                var map,
                    baseLayer,
                    timeScrubberContainer,
                    timeStepCarousel,
                    timeSteps = 25,
                    toggleLiveUpdate = false,
                    selectedTimeStep;

                // Map
                map = L.map('map', {
                    attributionControl: false,
                    zoomControl: false,
                    zoom: 5,
                    minZoom: 3,
                    maxZoom: 11,
                    maxBounds: L.latLngBounds(L.latLng(46.5, -13.5), L.latLng(61.5, 5.5)),
                    center: [52.0, -2]
                });

                // Base map layer
                //baseLayer = new L.tileLayer("http://ec2-35-178-192-41.eu-west-2.compute.amazonaws.com/styles/dev-atlas-minimal-mono-theme/{z}/{x}/{y}{r}.jpg").addTo(map);
                baseLayer = new L.tileLayer("http://www.donotbeonfire.co.uk:8080/styles/dev-atlas-minimal-mono-theme/{z}/{x}/{y}{r}.jpg").addTo(map);

                // Time scrubber container
                timeScrubberContainer = L.control({
                    position: 'bottomleft'
                });

                timeScrubberContainer.onAdd = function() {

                    var timeScrubberControl,
                        selectedTimeStepIndicator,
                        selectedTimeStepMarker;

                    // Time Scrubber Control
                    timeScrubberControl = L.DomUtil.create('div', 'time-scrubber-container');

                    // Disable mouse events
                    L.DomEvent.disableClickPropagation(timeScrubberControl);
                    L.DomEvent.disableScrollPropagation(timeScrubberControl);

                    // Selected Time Step Indicator
                    selectedTimeStepIndicator = L.DomUtil.create('div', 'selected-time-step-indicator', timeScrubberControl);
                    selectedTimeStepIndicator.id = 'selectedTimeStepIndicator';
                    selectedTimeStepIndicator.innerHTML = 'Selected time step: 0';

                    // Selected Time Step Marker
                    selectedTimeStepMarker = L.DomUtil.create('div', 'selected-time-step-marker', timeScrubberControl);
                    selectedTimeStepMarker.innerHTML = 'â–¼';

                    // Time Step Carousel
                    timeStepCarousel = L.DomUtil.create('div', 'time-step-carousel', timeScrubberControl);
                    timeStepCarousel.id = "timeStepCarousel";

                    // Create the Time Scrubber
                    timeStepCarousel = new Flickity(timeStepCarousel, {
                        setGallerySize: false,
                        cellAlign: 'center',
                        initialIndex: 0,
                        selectedAttraction: 0.1,
                        friction: 0.2,
                        prevNextButtons: false,
                        pageDots: false,
                        autoPlay: false,
                        on: {
                            ready: function(event) {

                                var counter,
                                    timeStepCells = [];

                                // Create the timesteps
                                for (counter = 0; counter < timeSteps; counter++) {

                                    var cell = document.createElement('div');
                                    cell.className = 'time-step-carousel-cell';
                                    cell.innerHTML = '<img src="resources/images/noun_measure_95971.svg">';
                                    timeStepCells.push(cell);

                                }

                                // Add to Time Scrubber
                                this.append(timeStepCells);

                            }
                        }
                    });

                    return timeScrubberControl;

                };

                timeScrubberContainer.addTo(map);

                // Handle on the selected time step indicator
                selectedTimeStepIndicator = document.getElementById('selectedTimeStepIndicator');

                // Handle on the time step carousel
                timeStepCarousel = Flickity.data(document.querySelector('.time-step-carousel'));

                if (toggleLiveUpdate) {

                    // If live updates required

                    // On Time Scrubber scroll event handler
                    timeStepCarousel.on('scroll', function(event) {

                        var count = timeScrubberControl.cells.length - 1,
                            target = Math.round((count / 100) * (event * 100));

                        if (target < 0 || target === -0) {
                            target = 0;
                        }

                        if (target > count) {
                            target = count;
                        }

                        if (target !== currentFrame) {

                            selectedTimeStep = target
                            selectedTimeStepIndicator.innerHTML = "Selected time step: " + selectedTimeStep;

                        }

                    });

                } else {

                    // Change events only

                    // On Time Scrubber change event handler
                    timeStepCarousel.on('change', function(event) {

                        selectedTimeStep = event;
                        selectedTimeStepIndicator.innerHTML = "Selected time step: " + selectedTimeStep;

                    });

                }

                window.addEventListener('load', function() {
                    timeStepCarousel.resize();
                });

                var bounds = L.latLngBounds(L.latLng(47.5, -12.5), L.latLng(60.5, 4.5));
                var mapCenter = new L.LatLng(51, -3);

                wmtsLayer = L.tileLayer.wms('https://betatest.metoffice.gov.uk/enthusiast/api/proxy/wms?', {
                    'service': 'WMS',
                    'version': '1.3.0',
                    'request': 'GetMap',
                    'layers': 'ukmo-500m-radar:precip_raw_5min:mm',
                    //'styles': 'VIRIDIS',
                    'format': 'image/png',
                    'uppercase': false,
                    //'model': 'mix',
                    //'time': '2019-08-07T14:00:00Z',
                    tileSize: 256,
                    bounds: bounds,
                    'AKA_Bypass': 'true'
                }).addTo(map);

            })



        </script>


<!--         <script>

             document.addEventListener('DOMContentLoaded', function(event) {

                var toggleLiveUpdate = false,
                    timeScrubberContainer,
                    timeScrubberControl,
                    currentFrameControl,
                    currentFrame;

                // Handle on the carousel
                timeScrubberContainer = document.getElementById('timeStepCarousel');

                // Create the Time Scrubber
                timeScrubberControl = new Flickity(timeScrubberContainer, {
                    setGallerySize: false,
                    cellAlign: 'center',
                    initialIndex: 0,
                    selectedAttraction: 0.1,
                    friction: 0.2,
                    prevNextButtons: false,
                    pageDots: false,
                    autoPlay: false,
                    on: {
                        ready: function(event) {
                            this.resize();
                        }
                    }
                });

                // Handle on the time step counter
                currentFrameControl = document.getElementById('currentFrame');

                if (toggleLiveUpdate) {

                    // If live updates required

                    // On Time Scrubber scroll event handler
                    timeScrubberControl.on('scroll', function(event) {

                        var count = timeScrubberControl.cells.length - 1,
                            target = Math.round((count / 100) * (event * 100));

                        if (target < 0 || target === -0) {
                            target = 0;
                        }

                        if (target > count) {
                            target = count;
                        }

                        if (target !== currentFrame) {

                            currentFrame = target
                            currentFrameControl.innerHTML = "Selected time step: " + currentFrame;

                        }

                    });

                } else {

                    // Change events only

                    // On Time Scrubber change event handler
                    timeScrubberControl.on('change', function(event) {

                        currentFrame = event;
                        currentFrameControl.innerHTML = "Selected time step: " + currentFrame;

                    });

                }

            })

        </script> -->

    </body>

</html>