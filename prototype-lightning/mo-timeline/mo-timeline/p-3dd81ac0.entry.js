import{r as i,c as t,h as s,g as e}from"./p-d56e5143.js";import{T as r,h as n}from"./p-0755b08e.js";import{R as h}from"./p-0d043429.js";import{T as a}from"./p-953a86c1.js";window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=function(i,t){t=t||window;for(var s=0;s<this.length;s++)i.call(t,this[s],s,this)});const o=class{constructor(s){i(this,s),this.dateClicked=t(this,"dateClicked",7),this.constraintChanged=t(this,"constraintChanged",7),this.timeLineConstraint={left:0,right:Number.MAX_SAFE_INTEGER},this.xOffset=0,this.timeBarPositions=[],this.resetTimeLine=!1,this.resetTimeLineConstraints=!1,this.setInitialSelectedTimeStep=!0}constrainTimelineHandler(){this.resetTimeLineConstraints=!0}watchHandler(){this.timeStepIndexUpdate()}timeStepsOnChangeHandler(i,t){this.timeStepSpacingService.setTimesteps(i),this.refreshTimeBarsPositions(),t&&i.length!==t.length&&(this.resetTimeLineConstraints=!0,this.resetTimeLine=!0)}watchMouseState(i,t){!t.up&&i.up&&this.mouseUp(i.xPos),t.over&&!i.over&&this.mouseUp(i.xPos),t.xPos!==i.xPos&&this.mouseMove(i.xPos),!t.down&&i.down&&this.mouseDown()}componentWillLoad(){this.timeStepSpacingService=new a(this.timeSteps),this.timeStepUtils=new r}componentDidUpdate(){this.resetTimeLineConstraints&&(this.resetConstraints(),this.resetTimeLineConstraints=!1),this.resetTimeLine&&(this.refreshTimeBarsPositions(),this.resetTimeLine=!1)}render(){return this.timeSteps&&this.timeSteps.length>0?s("div",{class:"slider"},s("div",{class:"slider__handle",ref:i=>this.handleElement=i}),this.timeSteps.map((i,t)=>s("div",{class:"slider__timeBarSpacing",style:this.timeStepProperties[t].style})),this.constrainTimeline&&s("div",{id:"constraints"},s("div",{id:"constrainLeft",class:"timeline-constraint",ref:i=>this.constraintLeft=i},s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"6",height:"45",viewBox:"0 0 6 45"},s("polygon",{fill:"#007AA9",id:"constrain_left",points:"0 0 6 0 6 45 0 30"}))),s("div",{id:"constrainRight",class:"timeline-constraint",ref:i=>this.constraintRight=i},s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"6",height:"45",viewBox:"0 0 6 45"},s("polygon",{fill:"#007AA9",id:"constrain_right",points:"0 0 6 0 6 30 0 45"}))))):s("div",null)}componentDidLoad(){this.refreshTimeBarsPositions(),window.addEventListener("resize",()=>{this.refreshTimeBarsPositions()}),new h(this.el.firstElementChild,()=>{this.refreshTimeBarsPositions()}),this.resetConstraints()}componentDidRender(){this.setInitialSelectedTimeStep&&void 0!==this.timeStepIndex&&void 0!==this.handleElement&&(this.moveElement(this.handleElement,this.timeStepIndex,"- 3px"),this.setInitialSelectedTimeStep=!1)}refreshTimeBarsPositions(){if(this.timeSteps&&this.timeSteps.length>0){let i;this.timeBarPositions=[],i=this.el.firstElementChild.querySelectorAll(".slider__timeBarSpacing"),i.forEach((i,t)=>{this.timeBarPositions.push({leftPos:i.getBoundingClientRect().left,rightPos:i.getBoundingClientRect().right,timeStepIndex:t})})}}mouseUp(i){let t=this.findNearestTimeStepToPointer(i);this.constraintLeftActive?(this.constraintLeftActive=!1,this.moveLeftConstraint(t)):this.constraintRightActive?(this.constraintRightActive=!1,this.moveRightConstraint(t)):(this.sliderHandleActive||this.el===this.mouseState.target||this.el.contains(this.mouseState.target))&&(this.sliderHandleActive=!1,t=this.findNearestActiveTimeStepToPointer(i),this.moveElement(this.handleElement,t,"- 3px"),this.handleDateClick(t))}mouseDown(){const i=window.document.getSelection();i.rangeCount>0&&i.getRangeAt(0).getClientRects().length>0&&i.removeAllRanges(),this.mouseState.target===this.handleElement?this.sliderHandleActive=!0:this.constrainTimeline&&(this.mouseState.target===this.constraintRight||this.constraintRight.contains(this.mouseState.target)?this.constraintRightActive=!0:(this.mouseState.target===this.constraintLeft||this.constraintLeft.contains(this.mouseState.target))&&(this.constraintLeftActive=!0))}mouseMove(i){if(this.sliderHandleActive){const t=this.findNearestActiveTimeStep(this.findNearestTimeStepToPointer(i));t!==this.timeStepIndex&&this.handleDateClick(t),this.moveElement(this.handleElement,t,"- 3px")}if(this.constraintLeftActive||this.constraintRightActive){const t=this.findNearestTimeStepToPointer(i);this.constraintRightActive&&this.moveRightConstraint(t),this.constraintLeftActive&&this.moveLeftConstraint(t)}}moveRightConstraint(i){i>this.timeLineConstraint.left&&(this.moveElement(this.constraintRight,i,"- 1px"),this.timeLineConstraint={left:this.timeLineConstraint.left,right:i},this.constraintChanged.emit(this.timeLineConstraint))}moveLeftConstraint(i){i<this.timeLineConstraint.right&&(this.moveElement(this.constraintLeft,i,"- 5px"),this.timeLineConstraint={left:i,right:this.timeLineConstraint.right},this.constraintChanged.emit(this.timeLineConstraint))}findNearestTimeStepToPointer(i){let t;if(i>this.timeBarPositions[this.timeBarPositions.length-1].rightPos)t=this.timeSteps.length-1;else if(i<this.timeBarPositions[0].leftPos)t=0;else for(const s of this.timeBarPositions)s.leftPos<=i&&s.rightPos>=i&&(t=s.timeStepIndex);return t}findNearestActiveTimeStepToPointer(i){let t=this.findNearestTimeStepToPointer(i);return t=this.findNearestActiveTimeStep(t),t}findNearestActiveTimeStep(i){return this.timeStepUtils.findNearestActiveTimeStep(i,this.timeSteps.length,this.disableTimesteps?this.loadedTimeStepMap:null,this.timeLineConstraint)}moveElement(i,t,s){void 0!==i&&(this.xOffset=parseFloat(this.calculateSnapPosition(t)),i.setAttribute("style","left: calc("+this.xOffset+"% "+s+") "))}calculateSnapPosition(i){return this.timeStepSpacingService.calculateLHSPosPercentage(i)}timeStepIndexUpdate(){this.sliderHandleActive||this.moveElement(this.handleElement,this.timeStepIndex,"- 3px")}handleDateClick(i){this.dateClicked.emit(i)}resetConstraints(){void 0!==this.timeSteps&&(this.timeLineConstraint.left=0,this.timeLineConstraint=this.timeStepUtils.resetTimelineConstraint(this.timeSteps.length),this.constrainTimeline&&(this.moveElement(this.constraintLeft,0,"- 5px"),this.moveElement(this.constraintRight,this.timeSteps.length-1,"- 1px")))}get el(){return e(this)}static get watchers(){return{constrainTimeline:["constrainTimelineHandler"],timeStepIndex:["watchHandler"],timeSteps:["timeStepsOnChangeHandler"],mouseState:["watchMouseState"]}}};o.style=".slider{margin-top:1.6rem;width:100%;height:2.2rem;position:absolute;z-index:3;cursor:pointer}.slider__handle{width:6.4px;height:inherit;background-color:#B9DC0C;border-radius:20px;position:absolute;z-index:1000}.slider__handle:hover{cursor:e-resize;background-color:#89a308}.slider__timeBarSpacing{display:inline-block;height:1rem;position:absolute}#constraints{width:100%;height:2.2rem}.timeline-constraint{display:inline-block;height:2.2rem;width:6px;position:absolute}.timeline-constraint:hover,.timeline-constraint:active{cursor:col-resize}";const l=class{constructor(t){i(this,t)}render(){if(this.timeData){let i="timeBar";return this.timeData.enabled||(i+=" timeBar__disabledTimestep"),s("div",{class:i,style:this.timeData.style},this.renderLabel(),this.renderVerticalLine())}return null}renderLabel(){return this.largeVerticalLineRequired()?s("div",{class:"timeBar__label"},this.timeData.timeStep.format(this.labelFormat)):s("div",{class:"timeBar__label"})}renderVerticalLine(){let i="timeBar__";return this.largeVerticalLineRequired()?i+="largeVerticalLine":i+="verticalLine",this.timeData.enabled||(i+="Disabled"),s("div",{class:i})}largeVerticalLineRequired(){return this.timeDivisionChange()}timeDivisionChange(){const i=n(this.timeData.previousTimeStep).day(),t=n(this.timeData.timeStep).day();return!this.timeData.previousTimeStep||i!==t}};var d;l.style=".timeBar{width:0;height:4rem;display:-ms-inline-flexbox;display:inline-flex;-ms-flex-direction:column;flex-direction:column;-ms-flex-align:center;align-items:center;z-index:2;position:absolute}.timeBar .timeBar__label{color:white;height:1rem;font-size:12px;margin-bottom:0.6rem;white-space:nowrap}.timeBar .timeBar__verticalLine{height:30%;margin-top:0.8rem;border-left:solid #C2C9CB thin;z-index:2}.timeBar .timeBar__verticalLineDisabled{height:30%;margin-top:0.8rem;border-left:solid #53676D thin;z-index:2}.timeBar .timeBar__largeVerticalLine{z-index:2;height:50%;border-left:solid white thin}.timeBar .timeBar__largeVerticalLineDisabled{z-index:2;height:50%;border-left:solid #53676D thin}",function(i){i.RED="RED",i.AMBER="AMBER",i.YELLOW="YELLOW"}(d||(d={}));const c=class{constructor(t){i(this,t),this.warnings=[]}render(){return s("div",{class:"warningsContainer"},s("div",{class:"warningsContainer__redWarnings"},this.renderWarnings(d.RED)),s("div",{class:"warningsContainer__amberWarnings"},this.renderWarnings(d.AMBER)),s("div",{class:"warningsContainer__yellowWarnings"},this.renderWarnings(d.YELLOW)))}renderWarnings(i){return this.warnings.map(t=>{if(n(t.validFrom).isBefore(n(this.lastTimeStep))&&t.severity===i)return s("div",{class:"warningsContainer__warning",id:"severity"+i.toString(),style:this.calculateWarningPosition(t)})})}calculateWarningPosition(i){return{width:this.calculateTimeDifferenceAsPercentage(n(i.validTo),n(i.validFrom))+"%",left:this.calculateTimeDifferenceAsPercentage(n(i.validFrom),n(this.firstTimeStep))+"%"}}calculateTimeDifferenceAsPercentage(i,t){const s=t.isBefore(n(this.firstTimeStep))?n(this.firstTimeStep):t,e=i.isBefore(n(this.firstTimeStep))?n(this.firstTimeStep):i,r=n.duration(n(e).diff(s)).asSeconds(),h=n.duration(n(this.lastTimeStep).diff(n(this.firstTimeStep))).asSeconds();return(Math.floor(r/h*100*100)/100).toFixed(2)}};c.style='.warningsContainer{width:100%;height:1.1rem;margin-top:2.5rem;position:absolute;z-index:1;left:0;display:grid;display:-ms-grid;-ms-grid-rows:1fr 1fr 1fr;overflow-x:hidden;grid-template-areas:"redWarning" "amberWarning" "yellowWarning"}.warningsContainer__redWarnings{grid-area:redWarning;-ms-grid-row:1;margin-bottom:0.075rem;position:absolute;width:100%}.warningsContainer__amberWarnings{grid-area:amberWarning;-ms-grid-row:2;margin-bottom:0.075rem;position:absolute;width:100%}.warningsContainer__yellowWarnings{-ms-grid-row:3;grid-area:yellowWarning;margin-bottom:0.075rem;position:absolute;width:100%}.warningsContainer__warning{height:4.5px;position:absolute;background-clip:content-box;margin-bottom:0.075rem}#severityRED{background-color:#CC0033}#severityAMBER{background-color:#FF9900}#severityYELLOW{background-color:#FFE923}';export{o as time_slider,l as time_step,c as timeline_warnings}