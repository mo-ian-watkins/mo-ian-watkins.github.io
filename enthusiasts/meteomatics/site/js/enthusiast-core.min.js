"use strict";window.metoffice=window.metoffice||{},window.metoffice.enthusiast=window.metoffice.enthusiast||{},window.metoffice.enthusiast.core=function(){var e,t,n,o,i=function(){e=L.map(n.map.container,{attributionControl:!1,zoomControl:!1,fadeAnimation:!1,minZoom:n.map.minZoom,maxZoom:n.map.maxZoom,maxBounds:L.latLngBounds(n.map.bounds.max),timeDimension:!0}),s(),e.on("click",function(e){window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.MAP_CLICKED,e.latlng)}),e.on("move",function(t){var n=e.getBounds(),o=[[n.getSouth(),n.getWest()],[n.getNorth(),n.getEast()]];window.metoffice.queryStringUtils.setHashedQueryStringParameter("bbox",JSON.stringify(o))})},s=function(){var o,i;window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.CORE_INITIALISED,function(){try{o=void 0===t.bbox?L.latLngBounds(n.map.bounds.initial):L.latLngBounds(JSON.parse(t.bbox))}catch(e){console.log(e.message)}o.isValid()&&(void 0===t.bbox?e.fitBounds(o,{paddingTopLeft:n.map.offsets.leftTop,paddingBottomRight:n.map.offsets.rightBottom}):e.fitBounds(o),o=e.getBounds(),i=[[o.getSouth(),o.getWest()],[o.getNorth(),o.getEast()]],window.metoffice.queryStringUtils.setHashedQueryStringParameter("bbox",JSON.stringify(i))),e.invalidateSize(!1)})},a=function(){var t,o;t=new L.tileLayer("",{type:"baseLayer",zIndex:200}).addTo(e),window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.LAYER_CHANGED,function(e){for(o=0;o<n.baseLayers.length;o++)n.baseLayers[o].theme===e.layerConfig.baseStyle&&t.setUrl(n.paths.pathBaseMap+"/"+n.baseLayers[o].id+"/"+n.baseLayers[o].template)})},f=function(){var t,o;e.createPane("overlay"),e.getPane("overlay").style.zIndex=400,e.getPane("overlay").style.pointerEvents="none",t=new L.tileLayer("",{type:"overlayLayer",pane:"overlay"}).addTo(e),window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.LAYER_CHANGED,function(e){for(o=0;o<n.overlayLayers.length;o++)n.overlayLayers[o].theme===e.layerConfig.baseStyle&&t.setUrl(n.paths.pathBaseMap+"/"+n.overlayLayers[o].id+"/"+n.overlayLayers[o].template)})},r=function(e){var t=new XMLHttpRequest;t.open("GET",e),t.onload=function(){u(t)},t.send()},u=function(e){200===e.status?(n=JSON.parse(e.responseText),d(n.paths.pathLatestRuns)):console.error("Configuration file failed to load",e.responseURL)},d=function(e){var t=new XMLHttpRequest;t.open("GET",e),t.onload=function(){w(e),c(t)},t.send()},c=function(s){200===s.status?(o=JSON.parse(s.responseText),t=window.metoffice.queryStringUtils.getAllHashedQueryStringParameters(),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.CONFIGURATION_LOADED,n),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.LATEST_RUNS_LOADED,o),i(),a(),f(),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.MAP_READY,e),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.CORE_INITIALISED)):console.error("Latest runs file failed to load",s.responseURL)},w=function(e){var t=new XMLHttpRequest;t.onload=function(){200===t.status?(o=JSON.parse(t.responseText),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.LATEST_RUNS_LOADED,o)):console.error("Latest runs file failed to load",t.responseURL)},window.setInterval(function(){t.open("GET",e),t.send()},3e5)};return{init:function(){r("./config.json")},getConfiguration:function(){return n}}}(),window.addEventListener("DOMContentLoaded",window.metoffice.enthusiast.core.init);