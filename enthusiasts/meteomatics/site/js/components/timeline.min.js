"use strict";window.metoffice=window.metoffice||{},window.metoffice.enthusiast=window.metoffice.enthusiast||{},window.metoffice.enthusiast.timeline=function(){var e,t,n,i,s,r,o,a=!1,c=function(e){var t;o=e,d(),void 0!==window.metoffice.enthusiast.core.getConfiguration().models?(t=b(),document.getElementById("lower-controls").appendChild(t)):console.error("No data layers found in configuration, control not created")},d=function(){o.on("movestart resize",function(e){a&&C()})},u=function(s){var o,a,c,d,u,w=s.timeSteps,b=window.metoffice.queryStringUtils.getAllHashedQueryStringParameters(),h=0,E=0;r=v(w),o=w.length,a=r.length,o>0&&(b.timestep&&-1!==(u=w.indexOf(parseInt(b.timestep)))&&(h=u),"last"===s.defaultTimeStep&&0===h&&(h=o-1,E=a-1),c=g(w),d=A(r),t.innerHTML="",t.appendChild(c),i.innerHTML="",i.appendChild(d),n=l("scrubber-container__date",E,m,f),e=l("scrubber-container__time",h,p),D())},l=function(e,t,n,i){return new MomentumSlider({el:"."+e,currentIndex:t,bounceCoefficient:.1,showIntermediateValues:!1,change:n,up:i})},m=function(e,t){var n=document.getElementsByClassName("date-slide");w(e,n,"date-slide--selected")},f=function(t){var n=document.getElementsByClassName("date-slide"),i=0;w(t,n,"date-slide--selected"),void 0!==e&&(i=e.currentIndex),x(t,i)},p=function(e,t){var n=document.getElementsByClassName("time-slide"),i=e<t&&a,s=o.timeDimension.getAvailableTimes()[e];w(e,n,"time-slide--selected"),T(e),window.metoffice.queryStringUtils.setHashedQueryStringParameter("timestep",s),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.TIMELINE_CHANGED,{timestepIndex:e,isRewindingWhilePlaying:i})},w=function(e,t,n){for(let e=0;e<t.length;e++)t[e].classList.remove(n);t[e].classList.add(n)},v=function(e){var t,n={},i=[],s={weekday:"short",month:"short",day:"numeric"};for(let i=0;i<e.length;i++)t=new Date(e[i]).toLocaleDateString("en-GB",s).replace(",",""),n.hasOwnProperty(t)||(n[t]=[]),n[t].push(e[i]);for(let e in n)i.push({date:e,timesteps:n[e]});return i},b=function(){var e=document.createElement("div"),n=document.createElement("div"),s=document.createElement("div"),r=document.createElement("span"),o=document.createElement("span"),a=h();return t=document.createElement("div"),i=document.createElement("div"),r.setAttribute("class","timeline-marker"),o.setAttribute("class","timeline-arrow"),r.appendChild(o),t.setAttribute("class","time-slider"),t.setAttribute("id","time-slider-container"),i.setAttribute("class","time-slider"),i.setAttribute("id","date-slider-container"),n.setAttribute("class","upper-control-container"),n.appendChild(i),s.setAttribute("class","lower-control-container"),s.appendChild(a),s.appendChild(t),e.setAttribute("class","control-container"),e.appendChild(r),e.appendChild(n),e.appendChild(s),e},h=function(){var e=document.createElement("button"),t=document.createElement("span");return t.setAttribute("class","icon icon--play"),t.setAttribute("id","play-icon"),t.textContent="Play",e.setAttribute("id","play-button"),e.setAttribute("class","button button--play"),e.appendChild(t),e.addEventListener("click",E),e},E=function(){(a=!a)?y():C()},g=function(t){var n,i,s=document.createElement("div"),r=t.length;s.setAttribute("class","scrubber-container scrubber-container__time"),s.setAttribute("tabindex","0"),s.addEventListener("keydown",function(t){var n=window.metoffice.keys;switch(t.keyCode){case n.LEFT:t.preventDefault(),e.prev();break;case n.RIGHT:t.preventDefault(),e.next()}}),(n=document.createElement("ul")).setAttribute("class","ms-track time-track");for(let e=0;e<r;e++)(i=document.createElement("li")).setAttribute("class","ms-slide time-slide"),i.textContent=L(t[e]),n.appendChild(i);return s.appendChild(n),s},A=function(t){var i,s,r,o=document.createElement("div"),a=t.length;o.setAttribute("class","scrubber-container scrubber-container__date"),o.setAttribute("tabindex","0"),o.addEventListener("keydown",function(t){var i=window.metoffice.keys;switch(t.keyCode){case i.LEFT:t.preventDefault(),n.prev(),x(n.currentIndex,e.currentIndex);break;case i.RIGHT:t.preventDefault(),n.next(),x(n.currentIndex,e.currentIndex)}}),(i=document.createElement("ul")).setAttribute("class","date-track");for(let e=0;e<a;e++)(s=document.createElement("li")).setAttribute("class","ms-slide date-slide"),(r=document.createElement("span")).setAttribute("class","date-slide-inner"),r.textContent=t[e].date,s.appendChild(r),i.appendChild(s);return o.appendChild(i),o},y=function(){var e=document.getElementById("play-icon");e.setAttribute("class","icon icon--pause"),e.textContent="Pause",a=!0,s=window.setInterval(I,1e3),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.TIMELINE_ANIMATING_CHANGED,{isPlaying:a})},C=function(){var e=document.getElementById("play-icon");e.setAttribute("class","icon icon--play"),e.textContent="Play",a=!1,window.clearInterval(s),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.TIMELINE_ANIMATING_CHANGED,{isPlaying:a})},I=function(){e.currentIndex>=e.sliderLength-1?e.select(0):e.next()},D=function(){var e=document.getElementsByClassName("scrubber-container");for(let t=0;t<e.length;t++)e[t].addEventListener("pointerdown",function(){a&&C()})},T=function(e){var t=o.timeDimension.getAvailableTimes()[e],i=r.length;for(let e=0;e<i;e++)for(let i=0;i<r[e].timesteps.length;i++)r[e].timesteps[i]===t&&n.select(e)},x=function(t,n){var i,s,a=new Date(o.timeDimension.getAvailableTimes()[n]),c=r[t].timesteps;for(let e=0;e<c.length;e++)i=new Date(c[e]),a.getHours()===i.getHours()&&a.getMinutes()===i.getMinutes()&&(s=N(c[e]));void 0===s&&(s=N(c[0])),void 0!==e&&e.select(s)},N=function(e){var t,n=0;for(let i=0;i<r.length;i++){if(-1!==r[i].timesteps.indexOf(e)){t=n+r[i].timesteps.indexOf(e);break}n+=r[i].timesteps.length}return t},L=function(e){var t=new Date(e);return String(t.getHours()<10?"0":"")+String(t.getHours())+":"+(String(t.getMinutes()<10?"0":"")+String(t.getMinutes()))};return{init:function(){window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.MAP_READY,c),window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.TIME_DIMENSION_CHANGED,u),window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.LAYER_CHANGED,function(){a&&C()}),window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.ALTITUDE_CHANGED,function(){a&&C()})},isPlaying:function(){return a},pause:C}}(),window.addEventListener("DOMContentLoaded",window.metoffice.enthusiast.timeline.init);