"use strict";window.metoffice=window.metoffice||{},window.metoffice.enthusiast=window.metoffice.enthusiast||{},window.metoffice.enthusiast.layerPicker=function(){var e,t,i,n,r,o,a,l,d,c=function(){var t,i;d=window.metoffice.queryStringUtils.getAllHashedQueryStringParameters(),void 0!==(e=window.metoffice.enthusiast.core.getConfiguration()).models?(w(),o=document.getElementById("layer-select-current"),a=window.metoffice.uiFactory.createSubHeaderElement("model-select-current"),o.parentNode.insertBefore(a,o),l=window.metoffice.uiFactory.createHeadingElement("altitude-select"),o.parentNode.appendChild(l),i=s(d),t=u(d,i),window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.CORE_INITIALISED,function(){p(e.models),C(i),f(i),g(t),window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.MODEL_CHANGED,m)})):console.error("No models found in configuration, control not created")},s=function(t){var i=e.models,n=i[0];if(t.model)for(let e=0;e<i.length;e++)if(i[e].id===t.model){n=i[e];break}return n},u=function(e,t){var i=t.layers,n=i[0];if(e.layer)for(let t=0;t<i.length;t++)if(i[t].id===e.layer){n=i[t];break}return n},m=function(e){var t=f(e);void 0!==t&&g(t)},f=function(e){var t,n,r,o,a,l,d=document.getElementById("layer-options");d.innerHTML="";for(let c=0;c<e.layers.length;c++)t=_(e.layers[c]),o=e.layers[c].parameter.vertical,d.appendChild(t),void 0!==o&&(r={layerId:e.layers[c].id,value:o},a=v(r),l="altitude-panel-"+e.layers[c].id,a.setAttribute("id",l),t.setAttribute("aria-controls",l),d.appendChild(a)),(void 0===n||void 0!==i&&i.id===e.layers[c].id)&&(n=e.layers[c]);return n},p=function(e){var t,i=document.getElementById("model-options");i.innerHTML="";for(let n=0;n<e.length;n++)t=h(e[n]),i.appendChild(t)},v=function(e){var t,i=document.createElement("div");i.setAttribute("class","picker__altitude-container hidden");for(let n=0;n<e.value.length;n++)t=E(e.layerId,e.value[n]),i.appendChild(t);return i},w=function(){var e=L.control();e.onAdd=function(){var e=document.createElement("div"),t=window.metoffice.uiFactory.createHeaderElement("layer-select","","","icon--layer icon--layer-accordion","icon--chevron-white","layer-picker-panel","picker__button--top-level"),i=window.metoffice.uiFactory.createHeaderElement("model-select","Data source","picker__header--model","","icon--chevron-white","model-picker-panel",""),n=window.metoffice.uiFactory.createPanelElement("layer-picker-panel","layer-select"),r=SimpleBar.instances.get(n).getContentElement(),o=window.metoffice.uiFactory.createOptionsElement("layer-options"),a=y(),l=document.createElement("div"),d=document.createElement("div"),c=window.metoffice.uiFactory.createContainerHeaderElement("Weather layer");return e.setAttribute("class","picker picker--layer"),l.setAttribute("class","picker__layers-container"),d.setAttribute("class","picker__models-container"),e.dataset.allowMultiple=!0,d.appendChild(i),d.appendChild(a),l.appendChild(c),l.appendChild(o),r.appendChild(d),r.appendChild(l),e.appendChild(t),e.appendChild(n),L.DomEvent.disableClickPropagation(e),L.DomEvent.disableScrollPropagation(e),window.metoffice.accordion.init(e),e},e.setPosition("topleft"),e.addTo(t)},y=function(){var e=document.createElement("div"),t=window.metoffice.uiFactory.createOptionsElement("model-options","picker__options--model");return e.setAttribute("id","model-picker-panel"),e.setAttribute("role","region"),e.setAttribute("aria-labelledby","model-select"),e.setAttribute("hidden",""),e.appendChild(t),e},_=function(e){var t=document.createElement("button");return t.setAttribute("class","picker__item picker__item--layer"),t.dataset.type=e.id,t.textContent=e.label,t.addEventListener("click",function(t){g(e)}),t},h=function(e){var t=document.createElement("button");return t.setAttribute("class","picker__item picker__item--model"),t.dataset.type=e.id,t.textContent=e.label,t.addEventListener("click",function(t){C(e)}),t},E=function(e,t){var i=document.createElement("button");return i.setAttribute("class","picker__item picker__item--altitude"),i.dataset.type=e,i.dataset.value=t,i.textContent=t,i.addEventListener("click",function(i){b(t,e)}),i},g=function(e){var t=document.getElementsByClassName("picker__item--layer"),a=document.getElementsByClassName("picker__altitude-container"),d=document.querySelector(".picker__item--layer[data-type='"+e.id+"']");for(let e=0;e<t.length;e++)t[e].classList.remove("picker__item--active");for(let e=0;e<a.length;e++)a[e].classList.add("hidden");i=e,o.textContent=e.label,null!=d&&d.classList.add("picker__item--active"),window.metoffice.queryStringUtils.setHashedQueryStringParameter("layer",e.id),void 0===e.parameter.vertical?(window.metoffice.queryStringUtils.removeHashedQueryStringParameter("altitude"),l.textContent="",r=null):document.getElementById("altitude-panel-"+e.id).classList.remove("hidden"),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.LAYER_CHANGED,{layerConfig:e,modelConfig:n,altitudeConfig:r})},C=function(e){var t=document.getElementsByClassName("picker__item--model"),i=document.querySelector(".picker__item--model[data-type='"+e.id+"']");for(let e=0;e<t.length;e++)t[e].classList.remove("picker__item--model-active");null!=i&&i.classList.add("picker__item--model-active"),void 0!==n&&n.id===e.id||(n=e,a.textContent=e.label,window.metoffice.queryStringUtils.setHashedQueryStringParameter("model",e.id),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.MODEL_CHANGED,e))},b=function(e,t){var i=document.getElementsByClassName("picker__item--altitude"),n=document.querySelector(".picker__item--altitude[data-value='"+e+"'][data-type='"+t+"']");for(let e=0;e<i.length;e++)i[e].classList.remove("picker__item--altitude-active");r=e,l.textContent=e,window.metoffice.queryStringUtils.setHashedQueryStringParameter("altitude",e),void 0!==n&&n.classList.add("picker__item--altitude-active"),window.metoffice.eventBus.notifyEventSubscribers(window.metoffice.enthusiast.eventDefinitions.ALTITUDE_CHANGED,e)};return{init:function(){window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.MAP_READY,function(e){t=e,c()}),window.metoffice.eventBus.subscribeToEvent(window.metoffice.enthusiast.eventDefinitions.LAYER_CHANGED,function(e){var t,i=window.metoffice.queryStringUtils.getAllHashedQueryStringParameters();void 0!==e.layerConfig.parameter.vertical&&(t=-1!==e.layerConfig.parameter.vertical.indexOf(i.altitude)?i.altitude:e.layerConfig.parameter.vertical[0],b(t,e.layerConfig.id))})},getCurrentLayer:function(){return i},getCurrentModel:function(){return n},getCurrentAltitude:function(){return r}}}(),window.addEventListener("DOMContentLoaded",window.metoffice.enthusiast.layerPicker.init);